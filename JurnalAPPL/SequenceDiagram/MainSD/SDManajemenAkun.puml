@startuml
title Sequence Diagram - Manajemen Akun (Login, Logout, Registrasi, Reset/Ubah Password, Kelola Profil, Verifikasi)

actor User
participant "Web/Mobile App" as App
participant "AccountController" as Controller
participant "UserService" as Service
participant "Email/SMS Service" as Notif
database "Database" as DB

== Registrasi Member ==
User -> App : Akses halaman registrasi
activate App
App -> Controller : submitForm(data)
activate Controller
Controller -> Service : validateRegistration(data)
activate Service
Service -> DB : cek email/username
activate DB
DB --> Service : result
deactivate DB
alt Data valid
    Service -> DB : simpan user baru
    activate DB
    DB --> Service : userId
    deactivate DB
    Service -> Notif : kirim kode verifikasi
    activate Notif
    Notif --> Service : delivered
    deactivate Notif
    Service --> Controller : success
    deactivate Service
    Controller --> App : Registrasi berhasil, cek email/telepon
    deactivate Controller
    deactivate App
else Data tidak valid
    Service --> Controller : error
    deactivate Service
    Controller --> App : Tampilkan error
    deactivate Controller
    deactivate App
end

== Verifikasi Email/Telepon ==
User -> App : Masukkan kode verifikasi
activate App
App -> Controller : verifyCode(code)
activate Controller
Controller -> Service : cekKodeVerifikasi(code)
activate Service
Service -> DB : validasi kode
activate DB
DB --> Service : result
deactivate DB
alt Kode valid
    Service -> DB : update isVerified=true
    activate DB
    DB --> Service : updated
    deactivate DB
    Service --> Controller : success
    deactivate Service
    Controller --> App : Akun terverifikasi
    deactivate Controller
    deactivate App
else Kode salah/tidak valid
    Service --> Controller : error
    deactivate Service
    Controller --> App : Tampilkan error
    deactivate Controller
    deactivate App
end

== Login ==
User -> App : Input username & password
activate App
App -> Controller : login(username, password)
activate Controller
Controller -> Service : authenticate(username, password)
activate Service
Service -> DB : cek user & password
activate DB
DB --> Service : user data
deactivate DB
alt Login sukses & verified
    Service --> Controller : token/session
    deactivate Service
    Controller --> App : Login berhasil
    deactivate Controller
    deactivate App
else Gagal (salah/konten belum verif)
    Service --> Controller : error
    deactivate Service
    Controller --> App : Tampilkan error
    deactivate Controller
    deactivate App
end

== Reset Password ==
User -> App : Klik "Lupa Password"
activate App
App -> Controller : requestReset(email/phone)
activate Controller
Controller -> Service : generateResetToken(email/phone)
activate Service
Service -> DB : cek user
activate DB
DB --> Service : user data
deactivate DB
alt User ditemukan
    Service -> DB : simpan reset token
    activate DB
    DB --> Service : token
    deactivate DB
    Service -> Notif : kirim link/kode reset
    activate Notif
    Notif --> Service : delivered
    deactivate Notif
    Service --> Controller : success
    deactivate Service
    Controller --> App : Link/kode reset dikirim
    deactivate Controller
    deactivate App
else Tidak ditemukan
    Service --> Controller : error
    deactivate Service
    Controller --> App : Tampilkan error
    deactivate Controller
    deactivate App
end

User -> App : Input kode/kata sandi baru
activate App
App -> Controller : resetPassword(token, newPwd)
activate Controller
Controller -> Service : verifyToken(token)
activate Service
Service -> DB : cek token
activate DB
DB --> Service : valid/invalid
deactivate DB
alt Token valid
    Service -> DB : update password
    activate DB
    DB --> Service : updated
    deactivate DB
    Service --> Controller : success
    deactivate Service
    Controller --> App : Reset password sukses
    deactivate Controller
    deactivate App
else Token tidak valid
    Service --> Controller : error
    deactivate Service
    Controller --> App : Tampilkan error
    deactivate Controller
    deactivate App
end

== Ubah Password ==
User -> App : Buka menu ubah password
activate App
App -> Controller : changePassword(oldPwd, newPwd)
activate Controller
Controller -> Service : cekPasswordLama(userId, oldPwd)
activate Service
Service -> DB : cek password lama
activate DB
DB --> Service : valid/invalid
deactivate DB
alt Password lama valid
    Service -> DB : update password
    activate DB
    DB --> Service : updated
    deactivate DB
    Service --> Controller : success
    deactivate Service
    Controller --> App : Password diubah
    deactivate Controller
    deactivate App
else Salah password lama
    Service --> Controller : error
    deactivate Service
    Controller --> App : Tampilkan error
    deactivate Controller
    deactivate App
end

== Kelola Profil ==
User -> App : Update profil (nama, foto, dst)
activate App
App -> Controller : updateProfile(data)
activate Controller
Controller -> Service : validateProfile(data)
activate Service
Service -> DB : update data user
activate DB
DB --> Service : success
deactivate DB
Service --> Controller : success
deactivate Service
Controller --> App : Profil diperbarui
deactivate Controller
deactivate App

== Logout ==
User -> App : Klik logout
activate App
App -> Controller : logout()
activate Controller
Controller -> Service : destroySession(token)
activate Service
Service --> Controller : success
deactivate Service
Controller --> App : Logout sukses
deactivate Controller
deactivate App

' Destruction (opsional, aktifkan jika ingin menampilkan objek di-destroy)
' destroy App
' destroy Controller
' destroy Service
' destroy Notif

@enduml
