@startuml
title Sequence Diagram - Komunikasi (Forum Diskusi & Customer Service Chat)

actor Member
actor "Customer Service" as CS
participant "Web/Mobile App" as App
participant "ForumController" as ForumCtrl
participant "ForumService" as ForumSvc
participant "ChatController" as ChatCtrl
participant "ChatService" as ChatSvc
database "Database" as DB

== Forum Diskusi ==
Member -> App : Akses forum diskusi
activate App
App -> ForumCtrl : getForumThreads()
activate ForumCtrl
ForumCtrl -> ForumSvc : fetchThreads()
activate ForumSvc
ForumSvc -> DB : query daftar thread
activate DB
DB --> ForumSvc : thread list
deactivate DB
ForumSvc --> ForumCtrl : thread list
deactivate ForumSvc
ForumCtrl --> App : tampilkan thread
deactivate ForumCtrl
deactivate App

Member -> App : Buat posting baru
activate App
App -> ForumCtrl : createThread(data)
activate ForumCtrl
ForumCtrl -> ForumSvc : createThread(data)
activate ForumSvc
ForumSvc -> DB : insert thread baru
activate DB
DB --> ForumSvc : threadId
deactivate DB
ForumSvc --> ForumCtrl : threadId
deactivate ForumSvc
ForumCtrl --> App : thread berhasil dibuat
deactivate ForumCtrl
deactivate App

Member -> App : Balas posting/thread
activate App
App -> ForumCtrl : replyThread(threadId, data)
activate ForumCtrl
ForumCtrl -> ForumSvc : replyThread(threadId, data)
activate ForumSvc
ForumSvc -> DB : insert reply baru
activate DB
DB --> ForumSvc : replyId
deactivate DB
ForumSvc --> ForumCtrl : replyId
deactivate ForumSvc
ForumCtrl --> App : reply berhasil
deactivate ForumCtrl
deactivate App

== Customer Service Chat ==
Member -> App : Mulai chat dengan CS
activate App
App -> ChatCtrl : startChat(memberId)
activate ChatCtrl
ChatCtrl -> ChatSvc : createChatSession(memberId)
activate ChatSvc
ChatSvc -> DB : insert chat session
activate DB
DB --> ChatSvc : chatSessionId
deactivate DB
ChatSvc --> ChatCtrl : chatSessionId
deactivate ChatSvc
ChatCtrl --> App : tampilkan chat window
deactivate ChatCtrl
deactivate App

Member -> App : Kirim pesan ke CS
activate App
App -> ChatCtrl : sendMessage(chatSessionId, pesan)
activate ChatCtrl
ChatCtrl -> ChatSvc : sendMessage(chatSessionId, pesan)
activate ChatSvc
ChatSvc -> DB : insert pesan
activate DB
DB --> ChatSvc : success
deactivate DB
ChatSvc --> ChatCtrl : success
deactivate ChatSvc
ChatCtrl --> App : pesan terkirim
deactivate ChatCtrl
deactivate App

CS -> App : Balas pesan
activate App
App -> ChatCtrl : sendMessage(chatSessionId, pesan)
activate ChatCtrl
ChatCtrl -> ChatSvc : sendMessage(chatSessionId, pesan)
activate ChatSvc
ChatSvc -> DB : insert pesan
activate DB
DB --> ChatSvc : success
deactivate DB
ChatSvc --> ChatCtrl : success
deactivate ChatSvc
ChatCtrl --> App : pesan diterima member
deactivate ChatCtrl
deactivate App

' Destruction (opsional, aktifkan jika objek benar-benar dihapus)
' destroy App
' destroy ForumCtrl
' destroy ForumSvc
' destroy ChatCtrl
' destroy ChatSvc

@enduml
